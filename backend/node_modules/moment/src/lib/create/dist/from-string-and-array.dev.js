"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.configFromStringAndArray = configFromStringAndArray;

var _constructor = require("../moment/constructor");

var _fromStringAndFormat = require("./from-string-and-format");

var _parsingFlags = _interopRequireDefault(require("./parsing-flags"));

var _valid = require("./valid");

var _extend = _interopRequireDefault(require("../utils/extend"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

// date from string and array of format strings
function configFromStringAndArray(config) {
  var tempConfig,
      bestMoment,
      scoreToBeat,
      i,
      currentScore,
      validFormatFound,
      bestFormatIsValid = false,
      configfLen = config._f.length;

  if (configfLen === 0) {
    (0, _parsingFlags["default"])(config).invalidFormat = true;
    config._d = new Date(NaN);
    return;
  }

  for (i = 0; i < configfLen; i++) {
    currentScore = 0;
    validFormatFound = false;
    tempConfig = (0, _constructor.copyConfig)({}, config);

    if (config._useUTC != null) {
      tempConfig._useUTC = config._useUTC;
    }

    tempConfig._f = config._f[i];
    (0, _fromStringAndFormat.configFromStringAndFormat)(tempConfig);

    if ((0, _valid.isValid)(tempConfig)) {
      validFormatFound = true;
    } // if there is any input that was not parsed add a penalty for that format


    currentScore += (0, _parsingFlags["default"])(tempConfig).charsLeftOver; //or tokens

    currentScore += (0, _parsingFlags["default"])(tempConfig).unusedTokens.length * 10;
    (0, _parsingFlags["default"])(tempConfig).score = currentScore;

    if (!bestFormatIsValid) {
      if (scoreToBeat == null || currentScore < scoreToBeat || validFormatFound) {
        scoreToBeat = currentScore;
        bestMoment = tempConfig;

        if (validFormatFound) {
          bestFormatIsValid = true;
        }
      }
    } else {
      if (currentScore < scoreToBeat) {
        scoreToBeat = currentScore;
        bestMoment = tempConfig;
      }
    }
  }

  (0, _extend["default"])(config, bestMoment || tempConfig);
}