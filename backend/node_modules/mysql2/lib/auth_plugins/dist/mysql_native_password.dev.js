'use strict'; //const PLUGIN_NAME = 'mysql_native_password';

var auth41 = require('../auth_41.js');

module.exports = function (pluginOptions) {
  return function (_ref) {
    var connection = _ref.connection,
        command = _ref.command;
    var password = command.password || pluginOptions.password || connection.config.password;
    var passwordSha1 = command.passwordSha1 || pluginOptions.passwordSha1 || connection.config.passwordSha1;
    return function (data) {
      var authPluginData1 = data.slice(0, 8);
      var authPluginData2 = data.slice(8, 20);
      var authToken;

      if (passwordSha1) {
        authToken = auth41.calculateTokenFromPasswordSha(passwordSha1, authPluginData1, authPluginData2);
      } else {
        authToken = auth41.calculateToken(password, authPluginData1, authPluginData2);
      }

      return authToken;
    };
  };
};